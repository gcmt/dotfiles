#!/bin/bash

cache_dir="$HOME/.cache"

if [[ ! -f "$cache_dir/battery-check" ]]; then
	echo 0 > "$cache_dir/battery-check"
fi

is_charging() {
	acpi -b | grep -q Charging
}

# usage: notify N "Message"
# Don't send notification if at least N seconds haven't passed since the last notification
notify() {
	is_charging && return
	local last_notification="$(cat "$cache_dir/battery-check")"
	local elapsed=$(expr $(date '+%s') - $last_notification)
	if (( $elapsed > "$1" )); then
		echo $(date '+%s') > "$cache_dir/battery-check"
		notify-send -t 10000 "Battery low" "$2"
	fi
}

main() {
	local charge=$(acpi -b | grep -Po '[0-9]+(?=%)')
	if (( $charge < 15 )); then
		notify 120 "Remaining charge:  $charge%"
	elif (( $charge < 30 )); then
		notify 360 "Remaining charge:  $charge%"
	fi
}

main
