#!/usr/bin/env python

import os
import sys
import time
import argparse
from datetime import datetime
from subprocess import run


def parse_args():
    parser = argparse.ArgumentParser(allow_abbrev=False)
    parser.add_argument('-wait', type=int, nargs='?', const=4)
    return parser.parse_known_args()


def main():

    args, import_args = parse_args()

    if args.wait:
        id = '6677'
        for s in reversed(range(1, args.wait+1)):
            run(['dunstify', '-r', id, f'Screenshot in {s} seconds', ''])
            time.sleep(1)
        run(['dunstify', '-C', id, '', ''])
        time.sleep(0.5)

    now = datetime.utcnow()
    home = os.environ['HOME']
    dest = f"{home}/Downloads/Screenshot_{now.strftime('%Y-%m-%d-%T')}.png"

    proc = run(['import'] + import_args + [dest])
    if proc.returncode:
        sys.exit(1)

    print(f"Screen captured at {dest}")

if __name__ == '__main__':
    main()
