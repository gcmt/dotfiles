#!/bin/bash

main() {

	local opts
	opts="-dmenu -p 'Move to'"
	opts="$opts -kb-custom-1 'Control+Return'"
	opts="$opts -theme 'main-light'"
	opts="$opts -theme-str 'window { width: 25%; }'"
	opts="$opts -theme-str 'listview { enabled: false; }'"
	opts="$opts -theme-str 'case-indicator { enabled: false; }'"
	opts="$opts -theme-str 'inputbar { padding: 0; }'"
	opts="$opts -theme-str 'entry { padding: 12; }'"
	opts="$opts -theme-str 'prompt { enabled: true; padding: 12; }'"
	opts="$opts -theme-str 'prompt { color: @prompt-color ; background-color: @prompt-background; }'"

	local name rofi_exit
	name="$(eval "rofi $opts")"
	rofi_exit=$?

	# strip whitespaces
	name="$(sed 's/\(\s\+$\|^\s\+\)//g' <<< "$name")"

	if (( rofi_exit == 1 )); then
		exit 1
	fi

	if [[ -z "$name" ]]; then
		# automatically pick a workspace when no name is given
		case $rofi_exit in
			10) i3-move-to-new-workspace ;;
			*) i3-move-to-new-workspace -follow ;;
		esac
	else
		local cmd
		cmd="move to workspace \"$name\""
		if [[ ! "$name" =~ ^_scratch$ && $rofi_exit != 10 ]]; then
			cmd="$cmd; workspace \"$name\""
		fi
		i3-msg "$cmd" >/dev/null
	fi

}

main
