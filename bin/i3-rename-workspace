#!/bin/bash

current_workspace_name() {
	i3-msg -t get_workspaces \
		| jq '.[] | select(.focused==true).name' \
		| cut -d "\"" -f 2
}

main() {

	# add a trailing space if the worksapce name is just a number
	current=$(current_workspace_name)
	if [[ "$current" =~ ^[0-9]+$ ]]; then
		current="$current "
	fi

	if (( reset == 1 )); then
		name=$(echo "$current" | grep -o "^[0-9]\\+")
	else
		opts="-dmenu -p 'Rename' -filter '$current' "
		opts="$opts -theme 'main-light'"
		opts="$opts -theme-str 'window { width: 25%; }'"
		opts="$opts -theme-str 'listview { enabled: false; }'"
		opts="$opts -theme-str 'case-indicator { enabled: false; }'"
		opts="$opts -theme-str 'inputbar { padding: 0; }'"
		opts="$opts -theme-str 'entry { padding: 12; }'"
		opts="$opts -theme-str 'prompt { enabled: true; padding: 12; color: #676b72; background-color: #dcdfe2; }'"
		name=$(echo "" | eval "rofi $opts" | sed 's/\(\s\+$\|^\s\+\)//g')
	fi

	if [[ -z "$name" ]]; then
		exit 1
	fi

	i3-msg "rename workspace to \"$name\"" >/dev/null

}

reset=0
if [[ "$*" =~ -reset($| ) ]]; then
	reset=1
fi

main
