#!/bin/bash

current_workspace_name() {
	i3-msg -t get_workspaces \
		| jq '.[] | select(.focused==true).name' \
		| cut -d "\"" -f 2
}

main() {

	# add a trailing space if the worksapce name is just a number
	local current
	current=$(current_workspace_name)
	if [[ "$current" =~ ^[0-9]+$ ]]; then
		current="$current "
	fi

	local opts name
	if (( reset == 1 )); then
		name="$(grep -o "^[0-9]\\+" <<< "$current")"
		if [[ -z "$name" ]]; then
			name="$(i3-new-workspace -dry)"
		fi
	else
		opts="-dmenu -p 'Name' -filter '$current' -theme 'i3-input'"
		name="$(eval "rofi $opts")"
		name="$(sed 's/\(\s\+$\|^\s\+\)//g' <<< "$name")"
	fi

	if [[ -z "$name" ]]; then
		exit 1
	fi

	i3-msg -q "rename workspace to \"$name\""

}

reset=0
if [[ "$*" =~ -reset($| ) ]]; then
	reset=1
fi

main
