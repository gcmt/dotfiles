#!/bin/bash

style="-theme 'main-light'"
style="$style -theme-str 'window { width: 25%; }'"
style="$style -theme-str 'listview { fixed-height: false; scrollbar: false; }'"
style="$style -theme-str 'case-indicator { enabled: false; }'"

options="-dmenu -kb-custom-1 'Control+BackSpace' -kb-custom-2 'Control+n'"

sessions=$(tmux ls -F '#{session_name}' 2>/dev/null | grep -v "cmus\\|calc")
session=$(echo "$sessions" | eval "rofi $options $style")
rofi_exit=$?

if [[ $rofi_exit == 1 || -z "$session" ]]; then
	exit 1
fi

case $rofi_exit in

	10)

		options="-dmenu -p 'Kill session \"$session\" ? '"
		style="$style -theme-str 'prompt { enabled: true; }'"
		choice=$(printf "yes\nno" | eval "rofi $options $style")
		if [[ $choice == yes ]]; then
			tmux kill-session -t "=$session"
		fi
		exec "$0"
		;;

	11)

		# open a new client linked to the current session in a different terminal window
		urxvt -e tmux new -t "$session" \; set destroy-unattached
		;;

	*)

		# If the tmux session is already opened, switch to it
		exec i3-focus -c URxvt -t "^$session - Tmux$" -fallback "urxvt -e t $session"
		;;

esac
