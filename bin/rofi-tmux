#!/bin/bash

style="-width 35"
style="$style -theme-str 'listview { fixed-height: false; scrollbar: false; }'"
style="$style -theme-str 'case-indicator { enabled: false; }'"

options="-dmenu -no-auto-select -p 'tmux ' -kb-custom-1 'Control+BackSpace'"

sessions=$(tmux ls -F '#{session_name}' 2>/dev/null | grep -v "cmus")
session=$(echo "$sessions" | eval "rofi $options $style")
rofi_exit=$?

if [[ $rofi_exit == 1 || -z "$session" ]]; then
	exit 1
fi

case $rofi_exit in

	10)

		options="-dmenu -p 'Kill session \"$session\" ? '"
		choice=$(printf "yes\nno" | eval "rofi $options $style")
		if [[ $choice == yes ]]; then
			tmux kill-session -t "=$session"
		fi
		exec "$0"
		;;

	*)

		# if the session is already opened, switch to it
		if i3-msg "[title=\"^$session\b\" title=\"Tmux\"] focus" | grep -q false; then
			exec urxvt -e t "$session"
		fi
		;;

esac
