#!/bin/bash

style="-theme 'main-light' -width 35"
style="$style -theme-str 'listview { fixed-height: false; scrollbar: false; }'"
style="$style -theme-str 'case-indicator { enabled: false; }'"

options="-dmenu -kb-custom-1 'Control+BackSpace'"

sessions=$(tmux ls -F '#{session_name}' 2>/dev/null | grep -v "cmus")
session=$(echo "$sessions" | eval "rofi $options $style")
rofi_exit=$?

if [[ $rofi_exit == 1 || -z "$session" ]]; then
	exit 1
fi

case $rofi_exit in

	10)

		options="-dmenu -p 'Kill session \"$session\" ? '"
		style="$style -theme-str 'prompt { enabled: true; }'"
		choice=$(printf "yes\nno" | eval "rofi $options $style")
		if [[ $choice == yes ]]; then
			tmux kill-session -t "=$session"
		fi
		exec "$0"
		;;

	*)

		# If the tmux session is already opened, switch to it
		cmd="[title=\"^$session - Tmux\"] focus"
		if i3-msg "$cmd" 2>/dev/null | grep -q false; then
			exec urxvt -e t "$session"
		fi
		;;

esac
