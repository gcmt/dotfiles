#!/bin/bash


_get_duration() {
	local n mod total=0
	for arg in "$@"; do
		n=$(echo "$arg" | grep -o '^[0-9]\+')
		(( $? != 0 )) && continue
		mod=$(echo "$arg" | grep -o '\([sm]$\|$\)')
		(( $? != 0 )) && continue
		case $mod in
			s) total=$(expr $total + $n);;
			m) total=$(expr $total + $n "*" 60);;
			*) total=$(expr $total + $n "*" 60);;
		esac
	done
	echo "$total"
}


fifo="/tmp/polybar_timer.fifo"

if [[ "$1" == start || "$1" =~ [0-9]+ ]]; then

	seconds="$(_get_duration "$@")"
	(( seconds > 0 )) || exit 1
	echo "start $seconds" > "$fifo"

elif [[ "$1" == toggle ]]; then

	seconds="$(_get_duration "$@")"
	(( seconds > 0 )) || exit 1
	echo "toggle $seconds" > "$fifo"

elif [[ "$1" == stop ]]; then

	echo "stop" > "$fifo"

else

	echo 2>&1 "Usage: timer [start|stop|toggle] [durations]"
	exit 1

fi
